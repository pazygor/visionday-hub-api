// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Empresa {
  id          Int      @id @default(autoincrement())
  cnpj        String   @unique @db.VarChar(14)
  razao_soc   String
  cidade      String
  uf          String   @db.VarChar(2)
  endereco    String
  bairro      String
  cep         String
  data_adesao DateTime @db.Date
  hora_adesao DateTime @db.Time(0)
  tenant      String
  users       User[]
  projects    Project[]
  servers     Server[]
}

model User {
  id         Int     @id @default(autoincrement())
  firstname  String
  lastname   String
  email      String  @unique
  phone      String?
  empresaId  Int
  empresa    Empresa @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  password   String
  groups     GroupUser[]
}

model Project {
  id         Int     @id @default(autoincrement())
  nome       String
  env        String
  tenant     String
  empresaId  Int
  empresa    Empresa @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  servers    Server[]
}

model Server {
  id            Int         @id @default(autoincrement())
  ip            String      @unique
  hostname      String
  so_name       String

  projectId     Int
  project       Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  empresaId     Int
  empresa       Empresa     @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  infra_alerts  InfraAlert[]
  app_alerts    AppAlert[]
  contacts      Contact[]
}

model Group {
  id          Int         @id @default(autoincrement())
  name        String
  description String?
  users       GroupUser[]
  alerts      GroupAlert[]
}

model GroupUser {
  id       Int    @id @default(autoincrement())
  userId   Int
  groupId  Int
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  group    Group  @relation(fields: [groupId], references: [id], onDelete: Cascade)
}

model GroupAlert {
  id              Int         @id @default(autoincrement())
  groupId         Int
  group           Group       @relation(fields: [groupId], references: [id], onDelete: Cascade)
  infraAlertId    Int?
  appAlertId      Int?
  infra_alert     InfraAlert? @relation(fields: [infraAlertId], references: [id], onDelete: Cascade)
  app_alert       AppAlert?   @relation(fields: [appAlertId], references: [id], onDelete: Cascade)
}

model InfraAlert {
  id              Int         @id @default(autoincrement())
  cpu             Int?
  saturation      Boolean?
  linux_memory    Int?
  windows_memory  Int?
  disk_latency    Int?
  disk_queue      Int?
  disk_partition  Int?
  network_packets BigInt?
  serverId        Int
  server          Server      @relation(fields: [serverId], references: [id], onDelete: Cascade)
  group_alerts    GroupAlert[]
}

model AppAlert {
  id         Int         @id @default(autoincrement())
  cpu        Int?
  ram_memory Int?
  serverId   Int
  server     Server      @relation(fields: [serverId], references: [id], onDelete: Cascade)
  group_alerts GroupAlert[]
}

model Contact {
  id        Int     @id @default(autoincrement())
  email     String
  phone     String
  serverId  Int
  alertId   Int
  server    Server  @relation(fields: [serverId], references: [id], onDelete: Cascade)
}